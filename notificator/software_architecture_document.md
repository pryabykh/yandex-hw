# Технический проект "Сервис отправки оповещений"

## Текущая архитектура

В текущей архитектуре у нас есть мобильное приложение, которое общается с компонентом "Controller", а он в свою очередь делает запросы к "Foo" и "Bar".

![alt text](static/current_arch.svg)


## Целевая архитектура

### Диаграмма контекста (C1):
![C1](static/C1-new.svg)

Подсистема должна предоставлять возможнсоть по нотификации по следующим каналам:
* Email
* Push
* SMS
А также быть интегрирована с существующим IAM для выполнения аутентификации и авторизации по средствам JWT.
Предполагается, что любой из существующих компонентов может отправить оповещение пользователю. При этом существующие каналы связи и предпочтения по их использованию известны системе оповещений, компоненты остальной системы знать это не должны.

### Диаграмма контейнеров (C2):
![C2](static/C2.svg)

Подсистема разрабатывается на базе микросервисной архитектуры (https://microservices.io/patterns/microservices.html). На уровне контейнеров состоит из следующих взаимосвязанных элементов.
* API Gateway - Является единой точной входа в подсистему. Осуществляет роутинг на микросервисы и аутентификацию по JWT. Реализует одноименный паттерн API Gateway (https://microservices.io/patterns/apigateway.html). Для имплементации был выбран Spring Cloud Gateway (https://spring.io/projects/spring-cloud-gateway)
* API подсистемы оповещений о событиях - Предоставляет API интерфейс для взаимодействия внешних систем, реализует бизнес логику по взаимодействию с пользовательскими настройками и добавлению оповещения в очередь сообщений в соответствии с этими настройками. Реализация на основе фреймворка Spring Boot (https://spring.io/projects/spring-boot).
* База данных - транзакционное хранилище. Содержит связь пользователей с настройками оповещений и прочую служебную информацию. В качестве БД была выбрана PostgreSQL.
* Брокер сообщений - хранит очередь оповещений, необходимых для отправки. Гарантирует доставку сообщения до соответствующих микросервисов. Отличным вариантом для реализации этой потребности является Apache Kafka.
* Сервисы отправки уведомлений (Email, Push, SMS). Слушают топик с оповещениями. Отправляют оповещения по соответствующим каналам.
### Диаграмма компонентов (C3):
![C3](static/C3.svg)

### Визуализация процесса взаимодействия компонентов:
![Porcess](static/Porcess.svg)

### В ходе разработки технического проекта были приняты и зафиксированы следующие архитектурные решения:
| ID  |   Дата  |   Статус  |   Участники  |   Решения    |
|-----|---------|-----------|---------------|---------------|
| [ADR-001] | [09.10.2023] | [Принято] | [Рябых Павел Александрович]         | [Выбор микросервисной архитектуры для нашей системы уведомлений](static/adr-001.md)     |
| [ADR-002] | [09.10.2023] | [Принято] | [Рябых Павел Александрович]         | [Выбор микросервисной архитектуры для нашей системы уведомлений](static/adr-002.md)     |
| [ADR-003] | [09.10.2023] | [Принято] | [Рябых Павел Александрович]         | [Использование Spring Boot для разработки микросервисов](static/adr-003.md)     |
| [ADR-004] | [09.10.2023] | [Принято] | [Рябых Павел Александрович]         | [Использование PostgreSQL для нашей базы данных](static/adr-004.md)     |
| [ADR-005] | [09.10.2023] | [Принято] | [Рябых Павел Александрович]         | [Использование Apache Kafka для обмена сообщениями и стриминга данных](static/adr-005.md)     |
| [ADR-006] | [09.10.2023] | [Принято] | [Рябых Павел Александрович]         | [Использование Spring Cloud Gateway в качестве API Gateway](static/adr-006.md)     |
